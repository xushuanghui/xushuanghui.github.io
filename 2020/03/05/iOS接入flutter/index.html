<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oc接入flutter | xushuanghui</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="前言：1、Swift 优秀的文档 免费和开源 代码可读性好 构建速度速度快  2、Flutter 完美的文档 跨平台：单一代码库为多个平台开发应用程序的优势，减少开发、测试工作量 速度快 图形引擎 加速开发的各种工具 热重载 插件和代码重用性：Flutter 还提供了各种各样的插件，以实现更快、更容易的开发 Flutter 动画 上市速度">
<meta property="og:type" content="article">
<meta property="og:title" content="oc接入flutter">
<meta property="og:url" content="http://example.com/2020/03/05/iOS%E6%8E%A5%E5%85%A5flutter/index.html">
<meta property="og:site_name" content="xushuanghui">
<meta property="og:description" content="前言：1、Swift 优秀的文档 免费和开源 代码可读性好 构建速度速度快  2、Flutter 完美的文档 跨平台：单一代码库为多个平台开发应用程序的优势，减少开发、测试工作量 速度快 图形引擎 加速开发的各种工具 热重载 插件和代码重用性：Flutter 还提供了各种各样的插件，以实现更快、更容易的开发 Flutter 动画 上市速度">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-05T07:44:02.000Z">
<meta property="article:modified_time" content="2023-04-21T10:20:59.722Z">
<meta property="article:author" content="xushuanghui">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="xushuanghui" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xushuanghui</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-iOS接入flutter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/05/iOS%E6%8E%A5%E5%85%A5flutter/" class="article-date">
  <time class="dt-published" datetime="2020-03-05T07:44:02.000Z" itemprop="datePublished">2020-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      oc接入flutter
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><h3 id="1、Swift"><a href="#1、Swift" class="headerlink" title="1、Swift"></a>1、<strong>Swift</strong></h3><ul>
<li>优秀的文档</li>
<li>免费和开源</li>
<li>代码可读性好</li>
<li>构建速度速度快</li>
</ul>
<h3 id="2、Flutter"><a href="#2、Flutter" class="headerlink" title="2、Flutter"></a>2、Flutter</h3><ul>
<li>完美的文档</li>
<li>跨平台：单一代码库为多个平台开发应用程序的优势，减少开发、测试工作量</li>
<li>速度快</li>
<li>图形引擎</li>
<li>加速开发的各种工具</li>
<li>热重载</li>
<li>插件和代码重用性：Flutter 还提供了各种各样的插件，以实现更快、更容易的开发</li>
<li>Flutter 动画</li>
<li>上市速度</li>
</ul>
<span id="more"></span>

<h3 id="1-flutter-module-创建与配置"><a href="#1-flutter-module-创建与配置" class="headerlink" title="1. flutter module 创建与配置"></a>1. flutter module 创建与配置</h3><h4 id="1-1-下载-flutter-基础包"><a href="#1-1-下载-flutter-基础包" class="headerlink" title="1.1 下载 flutter 基础包"></a>1.1 下载 flutter 基础包</h4><p>从 github 下载代码 <code>git clone -b beta https//github.com/flutter/flutter.git</code></p>
<p>但是 github 可能会很慢，可以从码云上下 <code>git clone https://gitee.com/mirrors/Flutter.git</code></p>
<h4 id="1-2-配置-flutter-环境变量"><a href="#1-2-配置-flutter-环境变量" class="headerlink" title="1.2 配置 flutter 环境变量"></a>1.2 配置 flutter 环境变量</h4><p>如果使用的 bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">第一步：</span><br><span class="line">cd ~           // 在终端进入用户目录，一般打开终端默认就是</span><br><span class="line"></span><br><span class="line">第二步：</span><br><span class="line">open .bash_profile    // 打开 bash 配置文件</span><br><span class="line">// 另 如果 .bash_profile文件不存在需先创建再打开，具体如下：</span><br><span class="line">// touch .bash_profile</span><br><span class="line">// open .bash_profile</span><br><span class="line"></span><br><span class="line">第三步：</span><br><span class="line"># for flutter</span><br><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br><span class="line">export PATH=/Users/hubery/dev_supports/flutter/bin:$PATH</span><br><span class="line"></span><br><span class="line">第四步：</span><br><span class="line">source .bash_profile      // 执行文件 使命令生效</span><br></pre></td></tr></table></figure>

<p>如果使用的 zsh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">第一步：</span><br><span class="line">cd ~           // 在终端进入用户目录，一般打开终端默认就是</span><br><span class="line"></span><br><span class="line">第二步：</span><br><span class="line">open .zshrc    // 打开 zsh 配置文件</span><br><span class="line"></span><br><span class="line">第三步：</span><br><span class="line"># for flutter</span><br><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br><span class="line">export PATH=/Users/hubery/dev_supports/flutter/bin:$PATH</span><br><span class="line"></span><br><span class="line">第四步：</span><br><span class="line">source .zshrc      // 执行文件 使命令生效</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中 <code>/Users/hubery/dev_supports/flutter</code> 为 1.1 中下载下来的 flutter 路径</p>
</blockquote>
<p>然后在终端中输入 <code>flutter</code> 验证环境变量是否配置成功，出现如下类似信息时表示配置是OK的</p>
<h4 id="1-3-flutter-module-创建"><a href="#1-3-flutter-module-创建" class="headerlink" title="1.3 flutter module 创建"></a>1.3 flutter module 创建</h4><p>可以使用 Android Studio 创建 flutter module</p>
<p>或者在目标目录下使用命令创建 <code>flutter create -t module flutter_demo_module_ios</code></p>
<p>创建的过程需要梯子从外网获取 flutter 相关资源。 这里推荐使用 Android Studio，操作方便，flutter 相关的插件支持的也挺好</p>
<h4 id="1-4-Android-Studio-上-flutter-项目配置"><a href="#1-4-Android-Studio-上-flutter-项目配置" class="headerlink" title="1.4 Android Studio 上 flutter 项目配置"></a>1.4 Android Studio 上 flutter 项目配置</h4><ul>
<li><p>使用 Android Studio 打开刚才创建的 module, 在 Project 栏可以看到项目目录结构</p>
<p>Android Studio –&gt; Preferences –&gt; Plugins –&gt; Marketplace 搜索 <code>Dart</code> 和 <code>Flutter</code> 插件并下载</p>
</li>
<li><p>配置 <code>Dart SDK path</code>, 设置入口为： Android Studio –&gt; Preferences –&gt; Languages &amp; Frameworks –&gt; Dart</p>
<p>配置完成后，Android Studio 工具栏就可以看到选择 devices 的选项啦，如果没出现可以重启 Android Studio</p>
</li>
</ul>
<!--more-->

<h4 id="1-5-检查-flutter-运行环境是否可用"><a href="#1-5-检查-flutter-运行环境是否可用" class="headerlink" title="1.5 检查 flutter 运行环境是否可用"></a>1.5 检查 flutter 运行环境是否可用</h4><p>执行命令 <code>flutter doctor</code></p>
<h4 id="1-6-如果flutter中插件安装，可在-pubspec-yaml-文件中添加需要的插件"><a href="#1-6-如果flutter中插件安装，可在-pubspec-yaml-文件中添加需要的插件" class="headerlink" title="1.6 如果flutter中插件安装，可在 pubspec.yaml 文件中添加需要的插件"></a>1.6 如果flutter中插件安装，可在 pubspec.yaml 文件中添加需要的插件</h4><ul>
<li>安装: <code>flutter pub get</code></li>
<li>更新: <code>flutter pub upgrade</code></li>
</ul>
<h4 id="1-7-执行编译"><a href="#1-7-执行编译" class="headerlink" title="1.7 执行编译"></a>1.7 执行编译</h4><ul>
<li>debug: <code>flutter build ios --debug --no-codesign</code></li>
<li>release: <code>flutter build ios --release --no-codesign</code></li>
</ul>
<h3 id="2-iOS-引入-flutter-module"><a href="#2-iOS-引入-flutter-module" class="headerlink" title="2. iOS 引入 flutter module"></a>2. iOS 引入 flutter module</h3><h4 id="2-1-创建-iOS-项目-amp-Pod-Init"><a href="#2-1-创建-iOS-项目-amp-Pod-Init" class="headerlink" title="2.1 创建 iOS 项目 &amp; Pod Init"></a>2.1 创建 iOS 项目 &amp; Pod Init</h4><p>如何创建 iOS项目以及 CocoaPods 的使用，此处就省略不表了 。。。</p>
<p>如需了解 CocoaPods，请戳传送门：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6d51362b7e64">CocoaPods 攻略</a></p>
<h4 id="2-2-使用-Cocoapods-引入-flutter-module"><a href="#2-2-使用-Cocoapods-引入-flutter-module" class="headerlink" title="2.2 使用 Cocoapods 引入 flutter module"></a>2.2 使用 Cocoapods 引入 flutter module</h4><ul>
<li><p>先执行编译该 <code>flutter_demo_module_ios</code> 项目, 终端执行 <code>flutter build ios --debug --no-codesign</code></p>
</li>
<li><p>iOS 项目中 Podfile 文件中添加如下命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Flutter</span><br><span class="line">flutter_application_path = &#x27;../flutter_demo_module_ios/&#x27;</span><br><span class="line">load File.join(flutter_application_path, &#x27;.ios&#x27;, &#x27;Flutter&#x27;, &#x27;podhelper.rb&#x27;)</span><br><span class="line">  	</span><br><span class="line">  	</span><br><span class="line">target &#x27;FlutterDemoIOSApp&#x27; do</span><br><span class="line">  # Comment the next line if you don&#x27;t want to use dynamic frameworks</span><br><span class="line">  use_frameworks!</span><br><span class="line">  	</span><br><span class="line">  # Flutter</span><br><span class="line">  install_all_flutter_pods(flutter_application_path)</span><br><span class="line">  	</span><br><span class="line">  	</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>然后执行 <code>pod install</code> 即可引入，在 pod 可以看到新增3个flutter相关的 framework</p>
</li>
</ul>
<h3 id="3-iOS-调用-flutter-页面"><a href="#3-iOS-调用-flutter-页面" class="headerlink" title="3. iOS 调用 flutter 页面"></a>3. iOS 调用 flutter 页面</h3><h4 id="3-1-多引擎调用"><a href="#3-1-多引擎调用" class="headerlink" title="3.1 多引擎调用"></a>3.1 多引擎调用</h4><p>多引擎调用就是每打开一个页面就实例化一个 <code>FlutterViewController</code></p>
<p>iOS 中的实现:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@objc</span><br><span class="line">    private func onOpenPageA() &#123;</span><br><span class="line">        let flutterVC = FlutterViewController()</span><br><span class="line">        flutterVC.setInitialRoute(&quot;one&quot;)</span><br><span class="line">        self.navigationController?.pushViewController(flutterVC, animated: true)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @objc</span><br><span class="line">    private func onOpenPageB() &#123;</span><br><span class="line">        let flutterVC = FlutterViewController()</span><br><span class="line">        flutterVC.setInitialRoute(&quot;two&quot;)</span><br><span class="line">        self.navigationController?.pushViewController(flutterVC, animated: true)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>flutter 中的实现:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:ui&#x27;;</span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter/services.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_demo_module_ios/pages/first_page.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_demo_module_ios/pages/second_page.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() =&gt; runApp(MyApp(pageIndex: window.defaultRouteName));</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  final String pageIndex;</span><br><span class="line"></span><br><span class="line">  const MyApp(&#123;Key key, this.pageIndex&#125;) : super(key: key);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: &#x27;Flutter Demo&#x27;,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: rootPage(pageIndex),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rootPage(String pageIndex) &#123;</span><br><span class="line">    switch (pageIndex) &#123;</span><br><span class="line">      case &#x27;one&#x27;:</span><br><span class="line">        return FirstPage();</span><br><span class="line">      case &#x27;two&#x27;:</span><br><span class="line">        return SecondPage();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在实例化 <code>FlutterViewController</code> 时为 flutter 指定对应的页面，flutter 根据传入的 key 创建对应的页面</p>
<p>起初 flutter 官方提供的是多引擎调用方式，简单来说是每打开一个页面创建一个 <code>FlutterViewController</code>, 每个 <code>FlutterViewController</code> 会对应一个 <code>FlutterEngine</code>, 而在页面退出时内存却没有完全释放，这就导致每打开一次页面内存会逐步增长</p>
<h4 id="3-2-单引擎调用"><a href="#3-2-单引擎调用" class="headerlink" title="3.2 单引擎调用"></a>3.2 单引擎调用</h4><p>所谓的单引擎就是全局只使用一个 <code>FlutterEngine</code>，再绑定唯一的 <code>FlutterViewController</code>，这样多引擎的内存问题也就基本得到了解决，这也是目前官方比较推荐方式。</p>
<p>由于全局只有 <code>FlutterViewController</code> ，那么在打开 flutter 页面前，需要通过消息通知 flutter 替换当前的 main page</p>
<p>iOS 中的实现:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">// 在 AppDelegate 中创建全局 FlutterEngine，并启动</span><br><span class="line">// 之所以在APP启动时就启动，是因为 FlutterEngine 启动时会有短暂的延迟，放在打开页面之前启动会明显感觉到卡顿</span><br><span class="line"></span><br><span class="line">var window: UIWindow?</span><br><span class="line">var flutterEngine: FlutterEngine?</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"> func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            // SceneDelegate 中处理</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            window = UIWindow(frame: UIScreen.main.bounds)</span><br><span class="line">            window?.backgroundColor = .white</span><br><span class="line">            let nav = UINavigationController(rootViewController: ViewController())</span><br><span class="line">            window?.rootViewController = nav</span><br><span class="line">            window?.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        self.flutterEngine = FlutterEngine(name: &quot;flutter-demo&quot;, project: nil)</span><br><span class="line">        self.flutterEngine?.run()</span><br><span class="line">        </span><br><span class="line">        return true</span><br><span class="line">    &#125;</span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line"></span><br><span class="line">    private var flutterVC: FlutterViewController!</span><br><span class="line">    private var msgChannel: FlutterBasicMessageChannel!</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        self.view.addSubview(button(frame: CGRect(x: 60, y: 150, width: 260, height: 40), title: &quot;Page A&quot;, selector: #selector(onOpenPageA)))</span><br><span class="line">        self.view.addSubview(button(frame: CGRect(x: 60, y: 250, width: 260, height: 40), title: &quot;Page B&quot;, selector: #selector(onOpenPageB)))</span><br><span class="line">        </span><br><span class="line">        let flutterEngine = (UIApplication.shared.delegate as? AppDelegate)?.flutterEngine</span><br><span class="line">        self.flutterVC = FlutterViewController(engine: flutterEngine!, nibName: nil, bundle: nil)</span><br><span class="line">        self.msgChannel = FlutterBasicMessageChannel(name: &quot;message-channel&quot;, binaryMessenger: flutterVC as! FlutterBinaryMessenger)</span><br><span class="line">        </span><br><span class="line">        self.msgChannel.setMessageHandler(&#123; (message, reply) in</span><br><span class="line">            print(&quot;message: \(String(describing: message))&quot;)</span><br><span class="line">            print(&quot;reply: \(String(describing: reply))&quot;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private func button(frame: CGRect, title: String, selector: Selector) -&gt; UIButton &#123;</span><br><span class="line">        let btn = UIButton()</span><br><span class="line">        btn.frame = frame</span><br><span class="line">        btn.backgroundColor = .red</span><br><span class="line">        btn.setTitle(title, for: .normal)</span><br><span class="line">        btn.setTitleColor(.white, for: .normal)</span><br><span class="line">        btn.addTarget(self, action: selector, for: .touchUpInside)</span><br><span class="line">        return btn</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @objc</span><br><span class="line">    private func onOpenPageA() &#123;</span><br><span class="line">        self.pushFlutterPage(pageName: &quot;one&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @objc</span><br><span class="line">    private func onOpenPageB() &#123;</span><br><span class="line">        self.pushFlutterPage(pageName: &quot;two&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private func pushFlutterPage(pageName: String) &#123;</span><br><span class="line">    </span><br><span class="line">        // 创建信息通道，name 需与 flutter 中保持一致</span><br><span class="line">        let methodChannel = FlutterMethodChannel(name: &quot;method-channel&quot;, binaryMessenger: flutterVC as! FlutterBinaryMessenger)</span><br><span class="line">        // 通知 flutter 将要展示的页面</span><br><span class="line">        methodChannel.invokeMethod(pageName, arguments: nil)</span><br><span class="line">        self.navigationController?.pushViewController(flutterVC, animated: true)</span><br><span class="line">        </span><br><span class="line">        // 监听 flutter 页面内的消息</span><br><span class="line">        methodChannel.setMethodCallHandler &#123; (call, result) in</span><br><span class="line">            let action = call.method</span><br><span class="line">            switch action &#123;</span><br><span class="line">            case &quot;back&quot;:</span><br><span class="line">                self.flutterVC.navigationController?.popViewController(animated: true)</span><br><span class="line">                </span><br><span class="line">            case &quot;changeBackgroundColor&quot;:</span><br><span class="line">                let colors: [UIColor] = [.black, .gray, .yellow, .orange, .brown]</span><br><span class="line">                let idx = arc4random()%4</span><br><span class="line">                self.view.backgroundColor = colors[Int(idx)]</span><br><span class="line">                </span><br><span class="line">            default:</span><br><span class="line">                break</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func touchesBegan(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) &#123;</span><br><span class="line">        // 向 flutter 发送信息</span><br><span class="line">        self.msgChannel?.sendMessage(NSDate().description)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flutter 中的实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:ui&#x27;;</span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter/services.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_demo_module_ios/pages/first_page.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_demo_module_ios/pages/second_page.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatefulWidget &#123;</span><br><span class="line">  _MyApp createState() =&gt; _MyApp();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _MyApp extends State&lt;MyApp&gt; &#123;</span><br><span class="line">  String pageIndex = &#x27;one&#x27;;</span><br><span class="line">  </span><br><span class="line">  // 注册消息通道</span><br><span class="line">  final MethodChannel _oneChannel = MethodChannel(&#x27;method-channel&#x27;);</span><br><span class="line">  final BasicMessageChannel _msgChannel = BasicMessageChannel(&#x27;message-channel&#x27;, StandardMessageCodec());</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    super.initState();</span><br><span class="line"></span><br><span class="line">    // 监听消息</span><br><span class="line">    _oneChannel.setMethodCallHandler((call) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        pageIndex = call.method;</span><br><span class="line">      &#125;);</span><br><span class="line">      return null;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _msgChannel.setMessageHandler((message) &#123;</span><br><span class="line">      print(&#x27;收到 native 信息: $message&#x27;);</span><br><span class="line">      return null;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: &#x27;Just a demo&#x27;,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: rootPage(pageIndex),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  rootPage(String pageIndex) &#123;</span><br><span class="line">    switch (pageIndex) &#123;</span><br><span class="line">      case &#x27;one&#x27;:</span><br><span class="line">        return FirstPage();</span><br><span class="line">      case &#x27;two&#x27;:</span><br><span class="line">        return SecondPage();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class FirstPage extends StatelessWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(&#x27;First Page 01&#x27;)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: RaisedButton(</span><br><span class="line">          onPressed: ()&#123;</span><br><span class="line">            // 点击事件, 返回上个页面</span><br><span class="line">            MethodChannel(&#x27;method-channel&#x27;).invokeMapMethod(&#x27;back&#x27;);</span><br><span class="line">          &#125;,</span><br><span class="line">          child: Text(&#x27;Back&#x27;),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">class SecondPage extends StatelessWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Scaffold(</span><br><span class="line">      appBar: AppBar(title: Text(&#x27;Second Page 02&#x27;)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: RaisedButton(</span><br><span class="line">          onPressed: ()&#123;</span><br><span class="line">            // 点击事件, 修改上个页面的背景色</span><br><span class="line">            MethodChannel(&#x27;method-channel&#x27;).invokeMapMethod(&#x27;changeBackgroundColor&#x27;);</span><br><span class="line">          &#125;,</span><br><span class="line">          child: Text(&#x27;ChangeBackgroundColor&#x27;),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-使用-FlutterBoost"><a href="#3-3-使用-FlutterBoost" class="headerlink" title="3.3 使用 FlutterBoost"></a>3.3 使用 FlutterBoost</h4><blockquote>
<p>官方描述</p>
<p>FlutterBoost 是一个Flutter插件，它可以轻松地为现有原生应用程序提供Flutter混合集成方案。FlutterBoost的理念是将Flutter像Webview那样来使用。在现有应用程序中同时管理Native页面和Flutter页面并非易事。 FlutterBoost 帮你处理页面的映射和跳转，你只需关心页面的名字和参数即可（通常可以是URL）</p>
</blockquote>
<p>FlutterBoost 的使用比较简单，但需要 native 与 flutter 都使用该插件，同时 flutter 内部页面的打开与关闭最好也使用该插件提供的方法</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/flutter_boost/blob/master/INTEGRATION.md">FlutterBoost 集成文档</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/05/iOS%E6%8E%A5%E5%85%A5flutter/" data-id="clgqem7vr001jh9d3ei3qg6n3" data-title="oc接入flutter" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/03/21/app%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          app启动时间优化
        
      </div>
    </a>
  
  
    <a href="/2020/02/21/%E9%81%87%E8%A7%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">遇见多线程问题记录</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/" rel="tag">Xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocoaPods/" rel="tag">cocoaPods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flutter/" rel="tag">flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS-AppDelegate/" rel="tag">iOS AppDelegate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" rel="tag">强化学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/" rel="tag">量化交易</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/cocoaPods/" style="font-size: 10px;">cocoaPods</a> <a href="/tags/flutter/" style="font-size: 10px;">flutter</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/iOS-AppDelegate/" style="font-size: 10px;">iOS AppDelegate</a> <a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">强化学习</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">机器学习</a> <a href="/tags/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/" style="font-size: 10px;">量化交易</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/11/%E5%AE%B9%E5%99%A8%E5%8C%96/">首页容器化</a>
          </li>
        
          <li>
            <a href="/2022/08/14/%E5%8A%A8%E6%80%81%E5%BA%93%E6%87%92%E5%8A%A0%E8%BD%BD/">动态库懒加载</a>
          </li>
        
          <li>
            <a href="/2022/03/17/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B2%BB%E7%90%86/">多线程问题专项治理</a>
          </li>
        
          <li>
            <a href="/2021/07/20/%E7%9B%B4%E6%92%AD%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/">直播性能指标监控方案</a>
          </li>
        
          <li>
            <a href="/2021/05/14/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/">视频相关优化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 xushuanghui<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>