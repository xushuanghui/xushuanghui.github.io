<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>xushuanghui</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="xushuanghui">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="xushuanghui">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xushuanghui">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="xushuanghui" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xushuanghui</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-容器化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/11/%E5%AE%B9%E5%99%A8%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2023-01-11T07:52:55.000Z" itemprop="datePublished">2023-01-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/11/%E5%AE%B9%E5%99%A8%E5%8C%96/">首页容器化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="1、首页容器类Controller问题"><a href="#1、首页容器类Controller问题" class="headerlink" title="1、首页容器类Controller问题"></a>1、首页容器类Controller问题</h3><ul>
<li><p>首页承担了短视频推荐、关注、直播等场景，基础功能，登录、性能监控，预加载等细节的业务逻辑差异较多，目前多业务代码耦合在一起，增加新功能时需要考虑其他业务方，容易引入问题，开发和测试效率低。导致 ViewController 越来越膨胀</p>
</li>
<li><p>一个版本经常会有多个业务在VC中进行修改导致冲突的情况，此时就需要多方进行 review，保证改动不出问题。</p>
</li>
</ul>
<h3 id="容器功能"><a href="#容器功能" class="headerlink" title="容器功能"></a>容器功能</h3><p>1、VC生命周期：ViewDidload、ViewWillAppear、ViewWilldisAppear，业务：cell管理、直播、推荐、关注等</p>
<p>2、TableView管理和代理方法：cellForRow:  willDisplayCell等，</p>
<p>3、网络请求、其他</p>
<h3 id="业务迭代效率低"><a href="#业务迭代效率低" class="headerlink" title="业务迭代效率低"></a>业务迭代效率低</h3><p>一个版本经常会有多个业务在容器中进行修改导致冲突的情况。</p>
<h3 id="2、目标"><a href="#2、目标" class="headerlink" title="2、目标"></a>2、目标</h3><ul>
<li><p>架构分层，明确每层职责，容器和业务解耦，多业务之间解耦，做到容器和业务各自闭环；</p>
</li>
<li><p>业务组件可插拔，不同场景支持灵活的组合和扩展业务组件；</p>
</li>
<li><p>搭建监控体系，实现稳定性、性能、问题定位，建立看板，实时了解各项指标；</p>
</li>
<li><p>防劣化，容器和业务分仓隔离，收敛维护人员；</p>
        
          <p class="article-more-link">
            <a href="/2023/01/11/%E5%AE%B9%E5%99%A8%E5%8C%96/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/11/%E5%AE%B9%E5%99%A8%E5%8C%96/" data-id="clgqf79ax001s5xd3gqbc88bj" data-title="首页容器化" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-动态库懒加载" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/08/14/%E5%8A%A8%E6%80%81%E5%BA%93%E6%87%92%E5%8A%A0%E8%BD%BD/" class="article-date">
  <time class="dt-published" datetime="2022-08-14T08:38:06.000Z" itemprop="datePublished">2022-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/08/14/%E5%8A%A8%E6%80%81%E5%BA%93%E6%87%92%E5%8A%A0%E8%BD%BD/">动态库懒加载</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="1、动态库懒加载"><a href="#1、动态库懒加载" class="headerlink" title="1、动态库懒加载"></a>1、动态库懒加载</h3><p>我们知道，pre-main 过程中，有dylib的加载步骤，而动态库加载是需要耗时的，苹果建议我们自定义的动态库不要超过 6 个，因此，尽量减少启动过程中的动态库加载有助于启动耗时的优化。减少启动过程中的动态库加载主要有以下两个方案：</p>
<ul>
<li>一个是动态库转静态库；</li>
<li>一个是多个动态库进行合并；</li>
</ul>
<h4 id="1-1、动态库懒加载方案"><a href="#1-1、动态库懒加载方案" class="headerlink" title="1.1、动态库懒加载方案"></a>1.1、动态库懒加载方案</h4><p>所谓动态库懒加载是指，在启动的过程中并不加载该动态库，而是在业务真正使用到该动态库中的内容时才进行加载，从而减少启动耗时。在 Cocoapods 1.2 之前存在配置动态库懒加载的入口，升级到 1.8 之后没有了动态库懒加载的配置入口，我们需要在pod install之后生成的配置文件中进行配置。使用 Cocoapods 管理的项目，在pod install之后，会生成Pods-xxx-frameworks.sh和Pods-xxx.adhoc&#x2F;debug&#x2F;release.xcconfig这两个文件，其中Pods-xxx-frameworks.sh文件脚本负责架构剔除和重签名等功能，而Pods-xxx.adhoc&#x2F;debug&#x2F;release.xcconfig文件则负责静态库和动态库的链接配置，我们自定义的动态库想要进行懒加载，只需要修改xxx.xcconfig配置文件，将需要懒加载的动态库从配置文件中移除，这样保证懒加载的动态库参与签名和拷贝，但是不参与链接。</p>
<h4 id="1-2、动态库懒加载后的调用方式"><a href="#1-2、动态库懒加载后的调用方式" class="headerlink" title="1.2、动态库懒加载后的调用方式"></a>1.2、动态库懒加载后的调用方式</h4><p>由于采用动态库懒加载后动态库在编译时没有参与链接，原有的代码调用方式会报找不到对应动态库符号的错误，因此，原有动态库的调用方式需要修改成Runtime动态调用的形式</p>
<p>正常动态库都是会被主二进制直接或者间接链接的，那么这些动态库会在启动的时候加载。<strong>如果只打包进 App，不参与链接，那么启动的时候就不会自动加载，在运行时需要用到动态库里面的内容的时候，再手动懒加载</strong>。</p>
<p>懒加载动态库需要在编译期和运行时都进行改造，编译期的架构：</p>
<p><img src="https://static001.infoq.cn/resource/image/53/a2/53277be65a8882bfb437aef8fba065a2.png" alt="img"></p>
        
          <p class="article-more-link">
            <a href="/2022/08/14/%E5%8A%A8%E6%80%81%E5%BA%93%E6%87%92%E5%8A%A0%E8%BD%BD/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/14/%E5%8A%A8%E6%80%81%E5%BA%93%E6%87%92%E5%8A%A0%E8%BD%BD/" data-id="clgqf79aw001q5xd32i1zak9m" data-title="动态库懒加载" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-多线程问题与治理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/03/17/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B2%BB%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2022-03-17T08:57:00.000Z" itemprop="datePublished">2022-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/03/17/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B2%BB%E7%90%86/">多线程问题专项治理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、目的"><a href="#1、目的" class="headerlink" title="1、目的"></a>1、目的</h2><p>多线程专项治理目的就是降低crash，手机发烫，耗电等问题。</p>
<h2 id="2、问题分析"><a href="#2、问题分析" class="headerlink" title="2、问题分析"></a>2、问题分析</h2><h4 id="2-1-滥用使用全局队列，并且使用了队列的默认优先级"><a href="#2-1-滥用使用全局队列，并且使用了队列的默认优先级" class="headerlink" title="2.1 滥用使用全局队列，并且使用了队列的默认优先级"></a>2.1 滥用使用全局队列，并且使用了队列的默认优先级</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">       <span class="comment">//TODO </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>导致大量的全局队列默认优先级，导致了一人干活，全家围观，还增加了造成线程死锁风险，从而引发crash</p>
<h4 id="2-2-大量不必要的线程切换"><a href="#2-2-大量不必要的线程切换" class="headerlink" title="2.2 大量不必要的线程切换"></a>2.2 大量不必要的线程切换</h4><h4 id="2-3-在高并发场景，没有控制并发量，而使用了全局队列创建了大量线程"><a href="#2-3-在高并发场景，没有控制并发量，而使用了全局队列创建了大量线程" class="headerlink" title="2.3  在高并发场景，没有控制并发量，而使用了全局队列创建了大量线程"></a>2.3  在高并发场景，没有控制并发量，而使用了全局队列创建了大量线程</h4>
        
          <p class="article-more-link">
            <a href="/2022/03/17/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B2%BB%E7%90%86/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/03/17/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B2%BB%E7%90%86/" data-id="clgqf79aw001o5xd385m60ac1" data-title="多线程问题专项治理" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-直播性能指标监控方案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/20/%E7%9B%B4%E6%92%AD%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-07-20T09:43:52.000Z" itemprop="datePublished">2021-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/20/%E7%9B%B4%E6%92%AD%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/">直播性能指标监控方案</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、数据收集"><a href="#一、数据收集" class="headerlink" title="一、数据收集"></a>一、数据收集</h2><p>完整的直播环节：采集、预处理、编码、推流、（传输、转码、分发）、拉流、解码、播放</p>
<ol>
<li>主播和观众端各自每10秒向服务器打点。</li>
<li>服务器接收到打点信息，为前端监控页面实时统计客户端直播播放情况。</li>
</ol>
<h3 id="1、主播端"><a href="#1、主播端" class="headerlink" title="1、主播端"></a>1、主播端</h3><ul>
<li>摄像头（分辨率、帧率、机型）–&gt; 视频预处理（cpu占用、内存占用）–&gt; 编码（视频质量、帧率）–&gt; 码率自适应（码率、丢帧数、卡顿数）–&gt; 地理位置、服务器的IP</li>
</ul>
<h3 id="2、播放端"><a href="#2、播放端" class="headerlink" title="2、播放端"></a>2、播放端</h3><ul>
<li><p>cdn边缘节点（节点运营商、地理位置、ping值）–&gt; 发送端至接收端延迟 –&gt; 接收缓冲（开播buffer长度、卡顿次数、卡顿时长）–&gt; 视频解码（帧率）–&gt; 播放（首帧时间）</p>
</li>
<li><p>播放失败的时候，上报错误信息和原因</p>
        
          <p class="article-more-link">
            <a href="/2021/07/20/%E7%9B%B4%E6%92%AD%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/20/%E7%9B%B4%E6%92%AD%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/" data-id="clgqf79az001w5xd3ffquf89p" data-title="直播性能指标监控方案" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-视频相关优化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/14/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2021-05-14T07:47:21.000Z" itemprop="datePublished">2021-05-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/14/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/">视频相关优化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、常见播放问题"><a href="#一、常见播放问题" class="headerlink" title="一、常见播放问题"></a>一、常见播放问题</h2><ul>
<li>列表加载慢</li>
<li>视频起播慢</li>
<li>视频播放失败</li>
<li>播放过程中卡顿</li>
<li>视频画面模糊</li>
<li>串音、有声无画、有画无声、声话不同步</li>
</ul>
<h4 id="1、收集问题"><a href="#1、收集问题" class="headerlink" title="1、收集问题"></a>1、收集问题</h4><ul>
<li>主动发现、收集，解决用户在播放过程中遇到的问题</li>
<li>推进从发布到播放的全链路优化，不断迭代播放策略</li>
</ul>
        
          <p class="article-more-link">
            <a href="/2021/05/14/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/14/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/" data-id="clgqf79b100225xd34yj289wt" data-title="视频相关优化" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-webview白屏问题记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/webview%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T08:17:02.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/webview%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">webview白屏问题记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>5.<strong>webview白屏问题</strong></p>
<p>一. URL网址无效或含有中文字符（入门级错误）<br>二、HTTP请求问题，设置URL Scheme 白名单<br>三. HTTPS 请求，未实现证书认证代理导致页面不加载的问题<br>didReceiveAuthenticationChallenge创建凭证，申请访问<br>四. iOS 8.0 - iOS 8.2 偶尔白屏问题</p>
<p><strong>白屏：遍历快照缩放后图片的像素点，对纯白像素占比大于99%的页面，认定其为白屏问题页。重新刷新</strong><br>六.  硬件内存不足、进程崩溃   <br>在 UIWebView 上当内存占用太大的时候，App Process 会 crash；而在 WKWebView 上当总体的内存占用比较大的时候，WebContent Process 会 crash，从而出现白屏现象。在 WKWebView 中加载下面的测试链接可以稳定重现白屏现</p>
<p>这个时候 WKWebView.URL 会变为 nil, 简单的 reload 刷新操作已经失效，对于一些长驻的H5页面影响比较大。参考解决方案：</p>
<h3 id="1、借助-WKNavigtionDelegate"><a href="#1、借助-WKNavigtionDelegate" class="headerlink" title="1、借助 WKNavigtionDelegate"></a>1、借助 WKNavigtionDelegate</h3><p>   iOS 9以后 WKNavigtionDelegate 新增了一个回调函数：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)webViewWebContentProcessDidTerminate:(WKWebView *)webView <span class="built_in">API_AVAILABLE</span>(<span class="built_in">macosx</span>(<span class="number">10.11</span>), <span class="built_in">ios</span>(<span class="number">9.0</span>))</span><br></pre></td></tr></table></figure>

<p>​    当 WKWebView 总体内存占用过大，页面即将白屏的时候，系统会调用上面的回调函数，我们在该函数里执行[webView reload](这个时候 webView.URL 取值尚不为 nil）解决白屏问题。在一些高内存消耗的页面可能会频繁刷新当前页面，H5侧也要做相应的适配操作。</p>
<p>2、检测 webView.title 是否为空</p>
<p><strong>3、某种资源加载失败了，也许是wk的某种机制把加载过的资源释放了</strong></p>
<p>于是尝试在本地html中加入资源加载的监听，只要发生错误，就调用location.reload();重载当前文档</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/17/webview%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" data-id="clgqf79au001h5xd31gyw2wyl" data-title="webview白屏问题记录" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-二进制重排" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/14/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%87%8D%E6%8E%92/" class="article-date">
  <time class="dt-published" datetime="2021-04-14T07:22:40.000Z" itemprop="datePublished">2021-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/14/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%87%8D%E6%8E%92/">二进制重排</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="效果对比"><a href="#效果对比" class="headerlink" title="效果对比"></a>效果对比</h3><p>优化前</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/29/1725eb8e7708dcfc~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<p>优化后</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/29/1725eb91f4f83a64~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<p>启动优化</p>
<h3 id="1、二进制重排实践"><a href="#1、二进制重排实践" class="headerlink" title="1、二进制重排实践"></a>1、二进制重排实践</h3><p>二进制重排的关键是获取启动过程中的符号，目前业界常用方案有：</p>
<ul>
<li>基于静态扫描+运行时 trace 的方案来获取启动时的符号，从而生成 order file 文件实现二进制重排；</li>
<li>基于 Clang 静态插桩的方式来获取启动过程中的所有函数符号；</li>
</ul>
<p>第一种方案存在对于initialize、block、以及 C++ 函数hook 不到的问题，第二种基于 Clang 静态插桩的方案则可以解决前种方案的不足获取到所有符号。因此，我们选择了基于 Clang 静态插桩的方案来获取启动符号.</p>
<h4 id="1-1、虚拟内存与-Page-Fault"><a href="#1-1、虚拟内存与-Page-Fault" class="headerlink" title="1.1、虚拟内存与 Page Fault"></a>1.1、虚拟内存与 Page Fault</h4><p>早期计算机中，并没有设计虚拟内存，程序都是直接从磁盘按序完整地加载进物理内存中，这种方式由于使用的是真实物理内存地址且程序是有序加载进去的，那么通过计算地址偏移就可以访问到其他程序的内存，存在安全隐患，另外由于是完整加载，而用户实际使用时只会用到少部分功能，这样也会造成内存的极大浪费。为了解决这些问题，现在的操作系统在物理内存的基础上引入了虚拟内存的概念。虚拟内存引入后，每个进程可以认为自己拥有从0x000000~0xffffff这一大片连续的内存空间，只不过这个内存地址是虚拟的，要访问实际物理内存地址，需要通过操作系统维护的一张映射表映射之后才可以真正访问到，而映射表是以页（Page）为单位进行管理的。<img src="https://img.toutiao.io/c/ee7a6c14a5cf367c4c1bce96efd184a6" alt="img"><br>当进程要访问的一个虚拟内存页在经过映射表映射之后发现对应的物理内存页不存在时，会触发一次缺页中断Page Fault，此时会发生 I&#x2F;O 操作，将磁盘中的数据读入到物理内存页中，读取的过程中苹果还会对读入的内存页进行验签处理，因此如果频繁发生Page Fault的话，Page Fault产生的耗时也不可小觑。Page Fault的数量可以通过 Instruments 自带的 System Trace 工具来查看，其中File Backed Page In就是Page Fault的次数。</p>
        
          <p class="article-more-link">
            <a href="/2021/04/14/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%87%8D%E6%8E%92/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/14/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%87%8D%E6%8E%92/" data-id="clgqf79av001j5xd39llj433g" data-title="二进制重排" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-离线化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/10/%E7%A6%BB%E7%BA%BF%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2021-03-10T08:10:50.000Z" itemprop="datePublished">2021-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/10/%E7%A6%BB%E7%BA%BF%E5%8C%96/">离线化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="1、方案比较"><a href="#1、方案比较" class="headerlink" title="1、方案比较"></a>1、方案比较</h3><p>H5离线包的基本原理是将html、js、css、图片等静态资源打包成压缩包，然后下载到客户端并解压，H5加载时直接从本地读取静态资源文件，减少网络请求，提高速度.</p>
<table>
<thead>
<tr>
<th>方案名</th>
<th>优点</th>
<th>缺点</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>加载本地路径</td>
<td>简单可靠，无需hook和调用私有API</td>
<td>有跨域问题，影响cookie和localstorage，H5需做少量改动</td>
<td></td>
</tr>
<tr>
<td>请求拦截</td>
<td>不修改加载URL，没有跨域问题，且支持网页部分资源离线化，灵活性和兼容性好</td>
<td>iOS端目前提供的NSURLProtocol和WKURLSchemehandler拦截方案，需要hook和调用私有API，来注册拦截。post请求体丢失</td>
<td></td>
</tr>
<tr>
<td>本地Web Server</td>
<td>兼容性好</td>
<td>对客户端耗电和CPU性能有影响</td>
<td></td>
</tr>
<tr>
<td>Service Worker</td>
<td>前端兼容性好</td>
<td>iOS端WKWebView不提供官方支持，实现技术难度大</td>
<td></td>
</tr>
</tbody></table>
<p>腾讯开源了离线包方案VasSonic（[github.com&#x2F;Tencent&#x2F;Vas…]</p>
        
          <p class="article-more-link">
            <a href="/2021/03/10/%E7%A6%BB%E7%BA%BF%E5%8C%96/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/10/%E7%A6%BB%E7%BA%BF%E5%8C%96/" data-id="clgqf79az001y5xd36eb55sdy" data-title="离线化" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-打包问题记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/07/%E6%89%93%E5%8C%85%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2021-03-07T03:23:06.000Z" itemprop="datePublished">2021-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/07/%E6%89%93%E5%8C%85%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">打包问题记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="通过jenkins打包ipa包报错：Command-CodeSign-failed-with-a-nonzero-exit-code（errSecInternalComponent）"><a href="#通过jenkins打包ipa包报错：Command-CodeSign-failed-with-a-nonzero-exit-code（errSecInternalComponent）" class="headerlink" title="通过jenkins打包ipa包报错：Command CodeSign failed with a nonzero exit code（errSecInternalComponent）"></a>通过jenkins打包ipa包报错：Command CodeSign failed with a nonzero exit code（errSecInternalComponent）</h1><p><strong>描述 ：</strong></p>
<p>在打包机通过 xcode打包不报错</p>
<p>在打包机直接运行打包shell不报错</p>
<p>但是通过jenkin打包就会出现下面的错误 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KitExtension.appex</span><br><span class="line">/Users/5i5j/Library/Developer/Xcode/DerivedData/cbs_new5iwork-ebjitbdetyopmbadzpizhbztfpyw/Build/Intermediates.noindex/ArchiveIntermediates/cbs_new5iwork/IntermediateBuildFilesPath/UninstalledProducts/iphoneos/CallKitExtension.appex: errSecInternalComponent</span><br><span class="line">Command CodeSign failed with a nonzero exit code</span><br></pre></td></tr></table></figure>

<p>出现这个问题的主要原因是是Jenkins，以ssh方式到slave机上，默认是没有账户的，但是访问钥匙串要求必须有用户身份</p>
<p>（回忆了一下自己通过Xcode打包的过程中，的确是要求输入过登录密码，之后才打包成功的。没想到通过xcode打包成功之后，再使用shell脚本直接打包，也还需要输入登录密码才能打包成功）</p>
<p><strong>解决办法</strong></p>
<p>添加一步输入密码解锁钥匙串，可以给Jenkins一个用户身份。 build步骤前添加一步解锁钥匙串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">security unlock-keychain -p &quot;login pwd&quot; ~/Library/Keychains/login.keychain</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/07/%E6%89%93%E5%8C%85%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" data-id="clgqf79ax001r5xd33jt9bxy9" data-title="打包问题记录" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-弱网优化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/28/%E5%BC%B1%E7%BD%91%E4%BC%98%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2020-12-28T09:53:02.000Z" itemprop="datePublished">2020-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/28/%E5%BC%B1%E7%BD%91%E4%BC%98%E5%8C%96/">弱网优化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>1、DNS优化 【核心解决安全问题】</p>
<p>DNS（Domain Name System），它的作用是根据域名查出IP地址</p>
<p><strong>核心问题</strong></p>
<ul>
<li><p>1）由于DNS劫持或故障造成的服务不可用</p>
</li>
<li><p>2）由于DNS调度不准确导致的性能退化</p>
</li>
<li><p>防止DNS的劫持，Eg：OS劫持率由0.12%降低到0.0002%，Android劫持率由0.25%降低到0.05%</p>
</li>
<li><p>降低网络时延，在调度不准确的情况下，会增大网络的时延，降低用户的体验</p>
</li>
</ul>
<p>2、<strong>连接优化</strong></p>
<ul>
<li>降低延迟</li>
<li>提升成功率</li>
</ul>
<p>3、<strong>弱网优化</strong> </p>
<ul>
<li><p>问题点1：移动网络环境如此复杂，我们如何确定当下就是弱网环境</p>
<p>问题点2: 确定为弱网环境下，我们如何提升弱网下的成功率，降低弱网下的时延，进而提升用户的网络体验</p>
        
          <p class="article-more-link">
            <a href="/2020/12/28/%E5%BC%B1%E7%BD%91%E4%BC%98%E5%8C%96/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/28/%E5%BC%B1%E7%BD%91%E4%BC%98%E5%8C%96/" data-id="clgqf79ax001t5xd3bmsideld" data-title="弱网优化" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocoaPods/" rel="tag">cocoaPods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flutter/" rel="tag">flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS-AppDelegate/" rel="tag">iOS AppDelegate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/" rel="tag">量化交易</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/cocoaPods/" style="font-size: 10px;">cocoaPods</a> <a href="/tags/flutter/" style="font-size: 10px;">flutter</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/iOS-AppDelegate/" style="font-size: 10px;">iOS AppDelegate</a> <a href="/tags/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/" style="font-size: 10px;">量化交易</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/11/%E5%AE%B9%E5%99%A8%E5%8C%96/">首页容器化</a>
          </li>
        
          <li>
            <a href="/2022/08/14/%E5%8A%A8%E6%80%81%E5%BA%93%E6%87%92%E5%8A%A0%E8%BD%BD/">动态库懒加载</a>
          </li>
        
          <li>
            <a href="/2022/03/17/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B2%BB%E7%90%86/">多线程问题专项治理</a>
          </li>
        
          <li>
            <a href="/2021/07/20/%E7%9B%B4%E6%92%AD%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88/">直播性能指标监控方案</a>
          </li>
        
          <li>
            <a href="/2021/05/14/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/">视频相关优化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 xushuanghui<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>